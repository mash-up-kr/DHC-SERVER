<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ê³„ì • ì‚­ì œ - DHC</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Apple SD Gothic Neo', 'Noto Sans KR', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 20px;
        }

        .container {
            background: white;
            border-radius: 20px;
            box-shadow: 0 15px 35px rgba(0, 0, 0, 0.1);
            padding: 40px;
            max-width: 500px;
            width: 100%;
            text-align: center;
        }

        .icon {
            font-size: 64px;
            margin-bottom: 24px;
            color: #ff6b6b;
        }

        h1 {
            color: #2c3e50;
            margin-bottom: 24px;
            font-size: 28px;
            font-weight: 700;
        }

        .warning-box {
            background: #fff3cd;
            border: 1px solid #ffeaa7;
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 24px;
            color: #856404;
        }

        .warning-box h3 {
            color: #d63031;
            margin-bottom: 12px;
            font-size: 18px;
        }

        .warning-box ul {
            text-align: left;
            margin-top: 12px;
            padding-left: 20px;
        }

        .warning-box li {
            margin-bottom: 8px;
            line-height: 1.4;
        }

        .user-info {
            background: #f8f9fa;
            border-radius: 8px;
            padding: 16px;
            margin-bottom: 24px;
            color: #495057;
        }

        .user-info strong {
            color: #2c3e50;
        }

        .button-group {
            display: flex;
            gap: 12px;
            justify-content: center;
            margin-top: 24px;
        }

        .btn {
            padding: 14px 28px;
            border: none;
            border-radius: 8px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            text-decoration: none;
            display: inline-block;
            min-width: 120px;
        }

        .btn-danger {
            background: #e74c3c;
            color: white;
        }

        .btn-danger:hover {
            background: #c0392b;
            transform: translateY(-2px);
        }

        .btn-secondary {
            background: #6c757d;
            color: white;
        }

        .btn-secondary:hover {
            background: #5a6268;
            transform: translateY(-2px);
        }

        .btn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            transform: none;
        }

        .success-message {
            background: #d4edda;
            border: 1px solid #c3e6cb;
            border-radius: 8px;
            padding: 20px;
            margin-bottom: 24px;
            color: #155724;
        }

        .error-message {
            background: #f8d7da;
            border: 1px solid #f5c6cb;
            border-radius: 8px;
            padding: 20px;
            margin-bottom: 24px;
            color: #721c24;
        }

        .loading {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid #f3f3f3;
            border-top: 3px solid #3498db;
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin-right: 8px;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .hidden {
            display: none;
        }

        .footer {
            margin-top: 32px;
            padding-top: 24px;
            border-top: 1px solid #eee;
            color: #6c757d;
            font-size: 14px;
        }

        @media (max-width: 576px) {
            .container {
                padding: 24px;
            }
            
            .button-group {
                flex-direction: column;
            }
            
            .btn {
                width: 100%;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="icon">âš ï¸</div>
        
        <h1>Flifin ê³„ì • ì‚­ì œ ìš”ì²­</h1>
        
        <!-- ì´ˆê¸° í™”ë©´ -->
        <div id="initialScreen">
            <div class="warning-box">
                <h3>ğŸš¨ ì¤‘ìš”í•œ ì•ˆë‚´ì‚¬í•­</h3>
                <p>ê³„ì •ì„ ì‚­ì œí•˜ë©´ ë‹¤ìŒ ë°ì´í„°ê°€ ì˜êµ¬ì ìœ¼ë¡œ ì‚­ì œë©ë‹ˆë‹¤:</p>
                <ul>
                    <li>ê°œì¸ ì •ë³´ (ìƒë…„ì›”ì¼, ì„±ë³„ ë“±)</li>
                    <li>ë¯¸ì…˜ ê¸°ë¡ ë° ì§„í–‰ ìƒí™©</li>
                    <li>ìš´ì„¸ ì •ë³´</li>
                    <li>ì €ì¶• ê¸ˆì•¡ ë° ë¶„ì„ ë°ì´í„°</li>
                    <li>ê¸°íƒ€ ëª¨ë“  ì•± ì‚¬ìš© ë°ì´í„°</li>
                </ul>
                <p><strong>âš ï¸ ì‚­ì œëœ ë°ì´í„°ëŠ” ë³µêµ¬í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.</strong></p>
            </div>
            
            <div class="user-info">
                <label for="userIdInput" style="display: block; margin-bottom: 8px; font-weight: bold;">ì‚¬ìš©ì IDë¥¼ ì…ë ¥í•˜ì„¸ìš”:</label>
                <input type="text" id="userIdInput" placeholder="ì‚¬ìš©ì IDë¥¼ ì…ë ¥í•˜ì„¸ìš”" style="width: 100%; padding: 12px; border: 1px solid #ddd; border-radius: 6px; font-size: 16px; margin-bottom: 12px;">
                <small style="color: #666; display: block; text-align: left;">ì•±ì—ì„œ í™•ì¸í•  ìˆ˜ ìˆëŠ” ì‚¬ìš©ì IDë¥¼ ì •í™•íˆ ì…ë ¥í•´ì£¼ì„¸ìš”.</small>
            </div>
            
            <div class="button-group">
                <button class="btn btn-danger" id="deleteBtn">ê³„ì • ì‚­ì œ</button>
                <button class="btn btn-secondary" onclick="window.close()">ì·¨ì†Œ</button>
            </div>
        </div>
        
        <!-- ë¡œë”© í™”ë©´ -->
        <div id="loadingScreen" class="hidden">
            <div class="loading"></div>
            <p>ê³„ì • ì‚­ì œ ì²˜ë¦¬ ì¤‘...</p>
        </div>
        
        <!-- ì„±ê³µ í™”ë©´ -->
        <div id="successScreen" class="hidden">
            <div class="success-message">
                <h3>âœ… ê³„ì • ì‚­ì œ ì™„ë£Œ</h3>
                <p>ê³„ì •ì´ ì„±ê³µì ìœ¼ë¡œ ì‚­ì œë˜ì—ˆìŠµë‹ˆë‹¤.</p>
                <p>ëª¨ë“  ë°ì´í„°ê°€ ì˜êµ¬ì ìœ¼ë¡œ ì‚­ì œë˜ì—ˆìœ¼ë©°, ë³µêµ¬í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.</p>
            </div>
            <p>DHC ì•±ì„ ì´ìš©í•´ ì£¼ì…”ì„œ ê°ì‚¬í–ˆìŠµë‹ˆë‹¤.</p>
        </div>
        
        <!-- ì—ëŸ¬ í™”ë©´ -->
        <div id="errorScreen" class="hidden">
            <div class="error-message">
                <h3>âŒ ì‚­ì œ ì‹¤íŒ¨</h3>
                <p id="errorMessage">ê³„ì • ì‚­ì œ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.</p>
            </div>
            <div class="button-group">
                <button class="btn btn-danger" id="retryBtn">ë‹¤ì‹œ ì‹œë„</button>
                <button class="btn btn-secondary" onclick="window.close()">ë‹«ê¸°</button>
            </div>
        </div>
        
        <div class="footer">
            <p>ê³„ì • ì‚­ì œì— ëŒ€í•œ ë¬¸ì˜ì‚¬í•­ì´ ìˆìœ¼ì‹œë©´ ê³ ê°ì„¼í„°ë¡œ ì—°ë½í•´ ì£¼ì„¸ìš”.</p>
        </div>
    </div>

    <script>
        // í˜„ì¬ ì„œë²„ ì£¼ì†Œë¥¼ ìë™ìœ¼ë¡œ ê°€ì ¸ì˜¤ê¸°
        const API_BASE_URL = window.location.origin;
        
        // ì‚¬ìš©ìê°€ ì…ë ¥í•œ userId ê°€ì ¸ì˜¤ê¸°
        function getUserIdFromInput() {
            const userIdInput = document.getElementById('userIdInput');
            return userIdInput.value.trim();
        }
        
        // ê³„ì • ì‚­ì œ API í˜¸ì¶œ
        async function deleteAccount(userId) {
            try {
                const response = await fetch(`${API_BASE_URL}/api/users/${userId}`, {
                    method: 'DELETE',
                    headers: {
                        'Content-Type': 'application/json',
                    }
                });
                
                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }
                
                return { success: true };
            } catch (error) {
                console.error('Delete account error:', error);
                return { 
                    success: false, 
                    error: error.message 
                };
            }
        }
        
        // í™”ë©´ ì „í™˜ í•¨ìˆ˜
        function showScreen(screenId) {
            const screens = ['initialScreen', 'loadingScreen', 'successScreen', 'errorScreen'];
            screens.forEach(id => {
                document.getElementById(id).classList.add('hidden');
            });
            document.getElementById(screenId).classList.remove('hidden');
        }
        
        // ì´ˆê¸°í™”
        document.addEventListener('DOMContentLoaded', function() {
            // ê³„ì • ì‚­ì œ ë²„íŠ¼ ì´ë²¤íŠ¸
            document.getElementById('deleteBtn').addEventListener('click', async function() {
                const userId = getUserIdFromInput();
                
                if (!userId) {
                    alert('ì‚¬ìš©ì IDë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”.');
                    document.getElementById('userIdInput').focus();
                    return;
                }
                
                // ê¸°ë³¸ì ì¸ MongoDB ObjectId í˜•ì‹ ê²€ì¦ (24ìë¦¬ hex ë¬¸ìì—´)
                if (!/^[0-9a-fA-F]{24}$/.test(userId)) {
                    alert('ì˜¬ë°”ë¥¸ ì‚¬ìš©ì ID í˜•ì‹ì´ ì•„ë‹™ë‹ˆë‹¤. 24ìë¦¬ ì˜ë¬¸ìì™€ ìˆ«ìë¡œ êµ¬ì„±ëœ IDë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”.');
                    document.getElementById('userIdInput').focus();
                    return;
                }
                
                if (!confirm('ì •ë§ë¡œ ê³„ì •ì„ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?\n\nì‚­ì œëœ ë°ì´í„°ëŠ” ë³µêµ¬í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.')) {
                    return;
                }
                
                if (!confirm('ë§ˆì§€ë§‰ í™•ì¸ì…ë‹ˆë‹¤.\n\nê³„ì •ì„ ì‚­ì œí•˜ë©´ ëª¨ë“  ë°ì´í„°ê°€ ì˜êµ¬ì ìœ¼ë¡œ ì‚­ì œë©ë‹ˆë‹¤.\nì •ë§ë¡œ ì§„í–‰í•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) {
                    return;
                }
                
                showScreen('loadingScreen');
                
                const result = await deleteAccount(userId);
                
                if (result.success) {
                    showScreen('successScreen');
                } else {
                    document.getElementById('errorMessage').textContent = 
                        `ê³„ì • ì‚­ì œ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤: ${result.error}`;
                    showScreen('errorScreen');
                }
            });
            
            // ì¬ì‹œë„ ë²„íŠ¼ ì´ë²¤íŠ¸
            document.getElementById('retryBtn').addEventListener('click', function() {
                showScreen('initialScreen');
            });
            
            // Enter í‚¤ë¡œ ì‚­ì œ ë²„íŠ¼ ì‹¤í–‰
            document.getElementById('userIdInput').addEventListener('keypress', function(e) {
                if (e.key === 'Enter') {
                    document.getElementById('deleteBtn').click();
                }
            });
        });
    </script>
</body>
</html> 